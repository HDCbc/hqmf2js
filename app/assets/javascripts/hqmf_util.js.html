<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>hqmf_util.js.coffee</title>
  <link rel="stylesheet" href="http://jashkenas.github.com/docco/resources/docco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>hqmf_util.js.coffee</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-1'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-1">&#182;</a>
        </div>
        <p>Represents an HL7 timestamp</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="k">class</span> <span class="nx">TS</span>
  </pre></div>
      </td>
    </tr>
    <tr id='section-2'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-2">&#182;</a>
        </div>
        <p>Create a new TS instance
hl7ts &ndash; an HL7 TS value as a string, e.g. 20121023131023 for
Oct 23, 2012 at 13:10:23.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nv">constructor: </span><span class="nf">(hl7ts, @inclusive=false) -&gt;</span>
    <span class="k">if</span> <span class="nx">hl7ts</span>
      <span class="nv">year = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">hl7ts</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
      <span class="nv">month = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">hl7ts</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
      <span class="nv">day = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">hl7ts</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
      <span class="nv">hour = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">hl7ts</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">hour</span><span class="p">)</span>
        <span class="nv">hour = </span><span class="mi">0</span>
      <span class="nv">minute = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">hl7ts</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">minute</span><span class="p">)</span>
        <span class="nv">minute = </span><span class="mi">0</span>
      <span class="vi">@date = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">year</span><span class="p">,</span> <span class="nx">month</span><span class="p">,</span> <span class="nx">day</span><span class="p">,</span> <span class="nx">hour</span><span class="p">,</span> <span class="nx">minute</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="vi">@date = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
  </pre></div>
      </td>
    </tr>
    <tr id='section-3'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-3">&#182;</a>
        </div>
        <p>Add a time period to th and return it
pq &ndash; a time period as an instance of PQ. Supports units of a (year), mo (month),
wk (week), d (day), h (hour) and min (minute).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nv">add: </span><span class="nf">(pq) -&gt;</span>
    <span class="k">if</span> <span class="nx">pq</span><span class="p">.</span><span class="nx">unit</span><span class="o">==</span><span class="s">&quot;a&quot;</span>
      <span class="nx">@date</span><span class="p">.</span><span class="nx">setFullYear</span><span class="p">(</span><span class="nx">@date</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span><span class="o">+</span><span class="nx">pq</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">pq</span><span class="p">.</span><span class="nx">unit</span><span class="o">==</span><span class="s">&quot;mo&quot;</span>
      <span class="nx">@date</span><span class="p">.</span><span class="nx">setMonth</span><span class="p">(</span><span class="nx">@date</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span><span class="o">+</span><span class="nx">pq</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">pq</span><span class="p">.</span><span class="nx">unit</span><span class="o">==</span><span class="s">&quot;wk&quot;</span>
      <span class="nx">@date</span><span class="p">.</span><span class="nx">setDate</span><span class="p">(</span><span class="nx">@date</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span><span class="o">+</span><span class="p">(</span><span class="mi">7</span><span class="o">*</span><span class="nx">pq</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">pq</span><span class="p">.</span><span class="nx">unit</span><span class="o">==</span><span class="s">&quot;d&quot;</span>
      <span class="nx">@date</span><span class="p">.</span><span class="nx">setDate</span><span class="p">(</span><span class="nx">@date</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span><span class="o">+</span><span class="nx">pq</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">pq</span><span class="p">.</span><span class="nx">unit</span><span class="o">==</span><span class="s">&quot;h&quot;</span>
      <span class="nx">@date</span><span class="p">.</span><span class="nx">setHours</span><span class="p">(</span><span class="nx">@date</span><span class="p">.</span><span class="nx">getHours</span><span class="p">()</span><span class="o">+</span><span class="nx">pq</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">pq</span><span class="p">.</span><span class="nx">unit</span><span class="o">==</span><span class="s">&quot;min&quot;</span>
      <span class="nx">@date</span><span class="p">.</span><span class="nx">setMinutes</span><span class="p">(</span><span class="nx">@date</span><span class="p">.</span><span class="nx">getMinutes</span><span class="p">()</span><span class="o">+</span><span class="nx">pq</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="k">throw</span> <span class="s">&quot;Unknown time unit: &quot;</span><span class="o">+</span><span class="nx">pq</span><span class="p">.</span><span class="nx">unit</span>
    <span class="k">this</span>
    </pre></div>
      </td>
    </tr>
    <tr id='section-4'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-4">&#182;</a>
        </div>
        <p>Returns the difference between this TS and the supplied TS as an absolute
number using the supplied granularity. E.g. if granularity is specified as year
then it will return the number of years between this TS and the supplied TS.
granularity &ndash; specifies the granularity of the difference. Supports units 
of a (year), mo (month), wk (week), d (day), h (hour) and min (minute).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nv">difference: </span><span class="nf">(ts, granularity) -&gt;</span>
    <span class="nv">earlier = later = </span><span class="kc">null</span>
    <span class="k">if</span> <span class="nx">@afterOrConcurrent</span><span class="p">(</span><span class="nx">ts</span><span class="p">)</span>
      <span class="nv">earlier = </span><span class="nx">ts</span><span class="p">.</span><span class="nx">asDate</span><span class="p">()</span>
      <span class="nv">later = </span><span class="nx">@date</span>
    <span class="k">else</span>
      <span class="nv">earlier = </span><span class="nx">@date</span>
      <span class="nv">later = </span><span class="nx">ts</span><span class="p">.</span><span class="nx">asDate</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">granularity</span><span class="o">==</span><span class="s">&quot;a&quot;</span>
      <span class="nx">TS</span><span class="p">.</span><span class="nx">yearsDifference</span><span class="p">(</span><span class="nx">earlier</span><span class="p">,</span><span class="nx">later</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">granularity</span><span class="o">==</span><span class="s">&quot;mo&quot;</span>
      <span class="nx">TS</span><span class="p">.</span><span class="nx">monthsDifference</span><span class="p">(</span><span class="nx">earlier</span><span class="p">,</span><span class="nx">later</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">granularity</span><span class="o">==</span><span class="s">&quot;wk&quot;</span>
      <span class="nx">TS</span><span class="p">.</span><span class="nx">weeksDifference</span><span class="p">(</span><span class="nx">earlier</span><span class="p">,</span><span class="nx">later</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">granularity</span><span class="o">==</span><span class="s">&quot;d&quot;</span>
      <span class="nx">TS</span><span class="p">.</span><span class="nx">daysDifference</span><span class="p">(</span><span class="nx">earlier</span><span class="p">,</span><span class="nx">later</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">granularity</span><span class="o">==</span><span class="s">&quot;h&quot;</span>
      <span class="nx">TS</span><span class="p">.</span><span class="nx">hoursDifference</span><span class="p">(</span><span class="nx">earlier</span><span class="p">,</span><span class="nx">later</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">granularity</span><span class="o">==</span><span class="s">&quot;min&quot;</span>
      <span class="nx">TS</span><span class="p">.</span><span class="nx">minutesDifference</span><span class="p">(</span><span class="nx">earlier</span><span class="p">,</span><span class="nx">later</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="k">throw</span> <span class="s">&quot;Unknown time unit: &quot;</span><span class="o">+</span><span class="nx">granularity</span>
  </pre></div>
      </td>
    </tr>
    <tr id='section-5'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-5">&#182;</a>
        </div>
        <p>Get the value of this TS as a JS Date</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nv">asDate: </span><span class="o">-&gt;</span>
    <span class="nx">@date</span>
    </pre></div>
      </td>
    </tr>
    <tr id='section-6'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-6">&#182;</a>
        </div>
        <p>Returns whether this TS is before the supplied TS ignoring seconds</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nv">before: </span><span class="nf">(other) -&gt;</span> 
    <span class="k">if</span> <span class="nx">@date</span><span class="o">==</span><span class="kc">null</span> <span class="o">||</span> <span class="nx">other</span><span class="p">.</span><span class="nx">date</span><span class="o">==</span><span class="kc">null</span>
      <span class="k">return</span> <span class="kc">false</span>
    <span class="k">if</span> <span class="nx">other</span><span class="p">.</span><span class="nx">inclusive</span>
      <span class="nx">beforeOrConcurrent</span><span class="p">(</span><span class="nx">other</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="p">[</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">]</span> <span class="o">=</span> <span class="nx">TS</span><span class="p">.</span><span class="nx">dropSeconds</span><span class="p">(</span><span class="nx">@date</span><span class="p">,</span> <span class="nx">other</span><span class="p">.</span><span class="nx">date</span><span class="p">)</span>
      <span class="nx">a</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span></pre></div>
      </td>
    </tr>
    <tr id='section-7'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-7">&#182;</a>
        </div>
        <p>Returns whether this TS is after the supplied TS ignoring seconds</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nv">after: </span><span class="nf">(other) -&gt;</span>
    <span class="k">if</span> <span class="nx">@date</span><span class="o">==</span><span class="kc">null</span> <span class="o">||</span> <span class="nx">other</span><span class="p">.</span><span class="nx">date</span><span class="o">==</span><span class="kc">null</span>
      <span class="k">return</span> <span class="kc">false</span>
    <span class="k">if</span> <span class="nx">other</span><span class="p">.</span><span class="nx">inclusive</span>
      <span class="nx">afterOrConcurrent</span><span class="p">(</span><span class="nx">other</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="p">[</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">]</span> <span class="o">=</span> <span class="nx">TS</span><span class="p">.</span><span class="nx">dropSeconds</span><span class="p">(</span><span class="nx">@date</span><span class="p">,</span> <span class="nx">other</span><span class="p">.</span><span class="nx">date</span><span class="p">)</span>
      <span class="nx">a</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span></pre></div>
      </td>
    </tr>
    <tr id='section-8'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-8">&#182;</a>
        </div>
        <p>Returns whether this TS is before or concurrent with the supplied TS ignoring seconds</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nv">beforeOrConcurrent: </span><span class="nf">(other) -&gt;</span>  
    <span class="k">if</span> <span class="nx">@date</span><span class="o">==</span><span class="kc">null</span> <span class="o">||</span> <span class="nx">other</span><span class="p">.</span><span class="nx">date</span><span class="o">==</span><span class="kc">null</span>
      <span class="k">return</span> <span class="kc">false</span>
    <span class="p">[</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">]</span> <span class="o">=</span> <span class="nx">TS</span><span class="p">.</span><span class="nx">dropSeconds</span><span class="p">(</span><span class="nx">@date</span><span class="p">,</span> <span class="nx">other</span><span class="p">.</span><span class="nx">date</span><span class="p">)</span>
    <span class="nx">a</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span></pre></div>
      </td>
    </tr>
    <tr id='section-9'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-9">&#182;</a>
        </div>
        <p>Returns whether this TS is after or concurrent with the supplied TS ignoring seconds</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nv">afterOrConcurrent: </span><span class="nf">(other) -&gt;</span>
    <span class="k">if</span> <span class="nx">@date</span><span class="o">==</span><span class="kc">null</span> <span class="o">||</span> <span class="nx">other</span><span class="p">.</span><span class="nx">date</span><span class="o">==</span><span class="kc">null</span>
      <span class="k">return</span> <span class="kc">false</span>
    <span class="p">[</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">]</span> <span class="o">=</span> <span class="nx">TS</span><span class="p">.</span><span class="nx">dropSeconds</span><span class="p">(</span><span class="nx">@date</span><span class="p">,</span> <span class="nx">other</span><span class="p">.</span><span class="nx">date</span><span class="p">)</span>
    <span class="nx">a</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span>
    </pre></div>
      </td>
    </tr>
    <tr id='section-10'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-10">&#182;</a>
        </div>
        <p>Return whether this TS and the supplied TS are within the same minute (i.e.
same timestamp when seconds are ignored)</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nv">withinSameMinute: </span><span class="nf">(other) -&gt;</span>
    <span class="p">[</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">]</span> <span class="o">=</span> <span class="nx">TS</span><span class="p">.</span><span class="nx">dropSeconds</span><span class="p">(</span><span class="nx">@date</span><span class="p">,</span> <span class="nx">other</span><span class="p">.</span><span class="nx">date</span><span class="p">)</span>
    <span class="nx">a</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span><span class="o">==</span><span class="nx">b</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span>
    </pre></div>
      </td>
    </tr>
    <tr id='section-11'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-11">&#182;</a>
        </div>
        <p>Number of whole years between the two time stamps (as Date objects)</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="vi">@yearsDifference: </span><span class="nf">(earlier, later) -&gt;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">later</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">earlier</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">())</span>
      <span class="nx">later</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span><span class="o">-</span><span class="nx">earlier</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">later</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">==</span> <span class="nx">earlier</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">later</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="nx">earlier</span><span class="p">.</span><span class="nx">getDate</span><span class="p">())</span>
      <span class="nx">later</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span><span class="o">-</span><span class="nx">earlier</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">later</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">==</span> <span class="nx">earlier</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">later</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">earlier</span><span class="p">.</span><span class="nx">getDate</span><span class="p">())</span>
      <span class="nx">later</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span><span class="o">-</span><span class="nx">earlier</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span>
      <span class="nx">later</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span><span class="o">-</span><span class="nx">earlier</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span>
      </pre></div>
      </td>
    </tr>
    <tr id='section-12'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-12">&#182;</a>
        </div>
        <p>Number of whole months between the two time stamps (as Date objects)</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="vi">@monthsDifference: </span><span class="nf">(earlier, later) -&gt;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">later</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="nx">earlier</span><span class="p">.</span><span class="nx">getDate</span><span class="p">())</span>
      <span class="p">(</span><span class="nx">later</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span><span class="o">-</span><span class="nx">earlier</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">())</span><span class="o">*</span><span class="mi">12</span><span class="o">+</span><span class="nx">later</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span><span class="o">-</span><span class="nx">earlier</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="p">(</span><span class="nx">later</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span><span class="o">-</span><span class="nx">earlier</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">())</span><span class="o">*</span><span class="mi">12</span><span class="o">+</span><span class="nx">later</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span><span class="o">-</span><span class="nx">earlier</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span>
      </pre></div>
      </td>
    </tr>
    <tr id='section-13'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-13">&#182;</a>
        </div>
        <p>Number of whole minutes between the two time stamps (as Date objects)</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="vi">@minutesDifference: </span><span class="nf">(earlier, later) -&gt;</span>
    <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(((</span><span class="nx">later</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span><span class="o">-</span><span class="nx">earlier</span><span class="p">.</span><span class="nx">getTime</span><span class="p">())</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span>
    </pre></div>
      </td>
    </tr>
    <tr id='section-14'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-14">&#182;</a>
        </div>
        <p>Number of whole hours between the two time stamps (as Date objects)</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="vi">@hoursDifference: </span><span class="nf">(earlier, later) -&gt;</span>
    <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">TS</span><span class="p">.</span><span class="nx">minutesDifference</span><span class="p">(</span><span class="nx">earlier</span><span class="p">,</span><span class="nx">later</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span>
  </pre></div>
      </td>
    </tr>
    <tr id='section-15'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-15">&#182;</a>
        </div>
        <p>Number of days betweem the two time stamps (as Date objects)</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="vi">@daysDifference: </span><span class="nf">(earlier, later) -&gt;</span></pre></div>
      </td>
    </tr>
    <tr id='section-16'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-16">&#182;</a>
        </div>
        <p>have to discard time portion for day difference calculation purposes</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nv">e = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">earlier</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">(),</span> <span class="nx">earlier</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">(),</span> <span class="nx">earlier</span><span class="p">.</span><span class="nx">getDate</span><span class="p">())</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">setUTCHours</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="nv">l = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">later</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">(),</span> <span class="nx">later</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">(),</span> <span class="nx">later</span><span class="p">.</span><span class="nx">getDate</span><span class="p">())</span>
    <span class="nx">l</span><span class="p">.</span><span class="nx">setUTCHours</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">TS</span><span class="p">.</span><span class="nx">hoursDifference</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">l</span><span class="p">)</span><span class="o">/</span><span class="mi">24</span><span class="p">)</span>
    </pre></div>
      </td>
    </tr>
    <tr id='section-17'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-17">&#182;</a>
        </div>
        <p>Number of whole weeks between the two time stmaps (as Date objects)</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="vi">@weeksDifference: </span><span class="nf">(earlier, later) -&gt;</span>
    <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">TS</span><span class="p">.</span><span class="nx">daysDifference</span><span class="p">(</span><span class="nx">earlier</span><span class="p">,</span><span class="nx">later</span><span class="p">)</span><span class="o">/</span><span class="mi">7</span><span class="p">)</span>
    </pre></div>
      </td>
    </tr>
    <tr id='section-18'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-18">&#182;</a>
        </div>
        <p>Drop the seconds from the supplied timeStamps (as Date objects)
returns the new time stamps with seconds set to 0 as an array</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="vi">@dropSeconds: </span><span class="nf">(timeStamps...) -&gt;</span>
    <span class="nv">timeStampsNoSeconds = </span><span class="k">for</span> <span class="nx">timeStamp</span> <span class="k">in</span> <span class="nx">timeStamps</span>
      <span class="nv">noSeconds = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">timeStamp</span><span class="p">.</span><span class="nx">getTime</span><span class="p">())</span>
      <span class="nx">noSeconds</span><span class="p">.</span><span class="nx">setSeconds</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
      <span class="nx">noSeconds</span>
    <span class="nx">timeStampsNoSeconds</span>
<span class="vi">@TS = </span><span class="nx">TS</span></pre></div>
      </td>
    </tr>
    <tr id='section-19'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-19">&#182;</a>
        </div>
        <p>Utility function used to extract data from a supplied object, hash or simple value
First looks for an accessor function, then an object property or hash key. If
defaultToValue is specified it will return the supplied value if neither an accessor
or hash entry exists, if false it will return null.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nv">fieldOrContainerValue = </span><span class="nf">(value, fieldName, defaultToValue=true) -&gt;</span>
  <span class="k">if</span> <span class="nx">value</span><span class="o">?</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">value</span><span class="p">[</span><span class="nx">fieldName</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;function&#39;</span>
      <span class="nx">value</span><span class="p">[</span><span class="nx">fieldName</span><span class="p">]()</span>
    <span class="k">else</span> <span class="k">if</span> <span class="k">typeof</span> <span class="nx">value</span><span class="p">[</span><span class="nx">fieldName</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;undefined&#39;</span>
      <span class="nx">value</span><span class="p">[</span><span class="nx">fieldName</span><span class="p">]</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">defaultToValue</span>
      <span class="nx">value</span>
    <span class="k">else</span>
      <span class="kc">null</span>
  <span class="k">else</span>
    <span class="kc">null</span>
<span class="vi">@fieldOrContainerValue = </span><span class="nx">fieldOrContainerValue</span></pre></div>
      </td>
    </tr>
    <tr id='section-20'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-20">&#182;</a>
        </div>
        <p>Represents an HL7 CD value</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="k">class</span> <span class="nx">CD</span>
  <span class="nv">constructor: </span><span class="nf">(@code, @system) -&gt;</span>
  </pre></div>
      </td>
    </tr>
    <tr id='section-21'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-21">&#182;</a>
        </div>
        <p>Returns whether the supplied code matches this one.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nv">match: </span><span class="nf">(codeOrHash) -&gt;</span></pre></div>
      </td>
    </tr>
    <tr id='section-22'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-22">&#182;</a>
        </div>
        <p>We might be passed a simple code value like &ldquo;M&rdquo; or a CodedEntry
Do our best to get a code value but only get a code system name if one is
supplied</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nv">codeToMatch = </span><span class="nx">fieldOrContainerValue</span><span class="p">(</span><span class="nx">codeOrHash</span><span class="p">,</span> <span class="s">&#39;code&#39;</span><span class="p">)</span>
    <span class="nv">systemToMatch = </span><span class="nx">fieldOrContainerValue</span><span class="p">(</span><span class="nx">codeOrHash</span><span class="p">,</span> <span class="s">&#39;codeSystemName&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">@system</span> <span class="o">&amp;&amp;</span> <span class="nx">systemToMatch</span>
      <span class="nx">@code</span><span class="o">==</span><span class="nx">codeToMatch</span> <span class="o">&amp;&amp;</span> <span class="nx">@system</span><span class="o">==</span><span class="nx">systemToMatch</span>
    <span class="k">else</span>
      <span class="nx">@code</span><span class="o">==</span><span class="nx">codeToMatch</span>
<span class="vi">@CD = </span><span class="nx">CD</span>
    </pre></div>
      </td>
    </tr>
    <tr id='section-23'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-23">&#182;</a>
        </div>
        <p>Represents a list of codes </p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="k">class</span> <span class="nx">CodeList</span>
  <span class="nv">constructor: </span><span class="nf">(@codes) -&gt;</span>
  </pre></div>
      </td>
    </tr>
    <tr id='section-24'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-24">&#182;</a>
        </div>
        <p>Returns whether the supplied code matches any of the contained codes</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nv">match: </span><span class="nf">(codeOrHash) -&gt;</span></pre></div>
      </td>
    </tr>
    <tr id='section-25'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-25">&#182;</a>
        </div>
        <p>We might be passed a simple code value like &ldquo;M&rdquo; or a CodedEntry
Do our best to get a code value but only get a code system name if one is
supplied</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nv">codeToMatch = </span><span class="nx">fieldOrContainerValue</span><span class="p">(</span><span class="nx">codeOrHash</span><span class="p">,</span> <span class="s">&#39;code&#39;</span><span class="p">)</span>
    <span class="nv">systemToMatch = </span><span class="nx">fieldOrContainerValue</span><span class="p">(</span><span class="nx">codeOrHash</span><span class="p">,</span> <span class="s">&#39;codeSystemName&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
    <span class="nv">result = </span><span class="kc">false</span>
    <span class="k">for</span> <span class="nx">codeSystemName</span><span class="p">,</span> <span class="nx">codeList</span> <span class="k">of</span> <span class="nx">@codes</span>
      <span class="k">for</span> <span class="nx">code</span> <span class="k">in</span> <span class="nx">codeList</span>
        <span class="k">if</span> <span class="nx">codeSystemName</span> <span class="o">&amp;&amp;</span> <span class="nx">systemToMatch</span> <span class="c1"># check that code systems match if both specified</span>
          <span class="k">if</span> <span class="nx">code</span><span class="o">==</span><span class="nx">codeToMatch</span> <span class="o">&amp;&amp;</span> <span class="nx">codeSystemName</span><span class="o">==</span><span class="nx">systemToMatch</span>
            <span class="nv">result = </span><span class="kc">true</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">code</span><span class="o">==</span><span class="nx">codeToMatch</span> <span class="c1"># no code systems to match to just match codes</span>
          <span class="nv">result = </span><span class="kc">true</span>
    <span class="nx">result</span>
<span class="vi">@CodeList = </span><span class="nx">CodeList</span>
    </pre></div>
      </td>
    </tr>
    <tr id='section-26'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-26">&#182;</a>
        </div>
        <p>Represents and HL7 physical quantity</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="k">class</span> <span class="nx">PQ</span>
  <span class="nv">constructor: </span><span class="nf">(@value, @unit, @inclusive=true) -&gt;</span>
  </pre></div>
      </td>
    </tr>
    <tr id='section-27'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-27">&#182;</a>
        </div>
        <p>Helper method to make a PQ behave like a patient API value</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nv">scalar: </span><span class="o">-&gt;</span> <span class="nx">@value</span>
  </pre></div>
      </td>
    </tr>
    <tr id='section-28'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-28">&#182;</a>
        </div>
        <p>Returns whether this is less than the supplied value</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nv">lessThan: </span><span class="nf">(scalarOrHash) -&gt;</span>
    <span class="nv">val = </span><span class="nx">fieldOrContainerValue</span><span class="p">(</span><span class="nx">scalarOrHash</span><span class="p">,</span> <span class="s">&#39;scalar&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">@inclusive</span>
      <span class="nx">@lessThanOrEqual</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">@value</span><span class="o">&lt;</span><span class="nx">val</span></pre></div>
      </td>
    </tr>
    <tr id='section-29'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-29">&#182;</a>
        </div>
        <p>Returns whether this is greater than the supplied value</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nv">greaterThan: </span><span class="nf">(scalarOrHash) -&gt;</span>
    <span class="nv">val = </span><span class="nx">fieldOrContainerValue</span><span class="p">(</span><span class="nx">scalarOrHash</span><span class="p">,</span> <span class="s">&#39;scalar&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">@inclusive</span>
      <span class="nx">@greaterThanOrEqual</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">@value</span><span class="o">&gt;</span><span class="nx">val</span></pre></div>
      </td>
    </tr>
    <tr id='section-30'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-30">&#182;</a>
        </div>
        <p>Returns whether this is less than or equal to the supplied value</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nv">lessThanOrEqual: </span><span class="nf">(scalarOrHash) -&gt;</span>
    <span class="nv">val = </span><span class="nx">fieldOrContainerValue</span><span class="p">(</span><span class="nx">scalarOrHash</span><span class="p">,</span> <span class="s">&#39;scalar&#39;</span><span class="p">)</span>
    <span class="nx">@value</span><span class="o">&lt;=</span><span class="nx">val</span></pre></div>
      </td>
    </tr>
    <tr id='section-31'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-31">&#182;</a>
        </div>
        <p>Returns whether this is greater than or equal to the supplied value</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nv">greaterThanOrEqual: </span><span class="nf">(scalarOrHash) -&gt;</span>
    <span class="nv">val = </span><span class="nx">fieldOrContainerValue</span><span class="p">(</span><span class="nx">scalarOrHash</span><span class="p">,</span> <span class="s">&#39;scalar&#39;</span><span class="p">)</span>
    <span class="nx">@value</span><span class="o">&gt;=</span><span class="nx">val</span>
    </pre></div>
      </td>
    </tr>
    <tr id='section-32'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-32">&#182;</a>
        </div>
        <p>Returns whether this is equal to the supplied value or hash</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nv">match: </span><span class="nf">(scalarOrHash) -&gt;</span>
    <span class="nv">val = </span><span class="nx">fieldOrContainerValue</span><span class="p">(</span><span class="nx">scalarOrHash</span><span class="p">,</span> <span class="s">&#39;scalar&#39;</span><span class="p">)</span>
    <span class="nx">@value</span><span class="o">==</span><span class="nx">val</span>
<span class="vi">@PQ = </span><span class="nx">PQ</span>
  
<span class="k">class</span> <span class="nx">IVL_PQ</span>
  <span class="nv">constructor: </span><span class="nf">(@low_pq, @high_pq) -&gt;</span>
    <span class="k">if</span> <span class="o">!</span><span class="nx">@low_pq</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">@high_pq</span>
      <span class="k">throw</span> <span class="s">&quot;Must have a lower or upper bound&quot;</span>
    <span class="k">if</span> <span class="nx">@low_pq</span> <span class="o">&amp;&amp;</span> <span class="nx">@low_pq</span><span class="p">.</span><span class="nx">unit</span> <span class="o">&amp;&amp;</span> <span class="nx">@high_pq</span> <span class="o">&amp;&amp;</span> <span class="nx">@high_pq</span><span class="p">.</span><span class="nx">unit</span> <span class="o">&amp;&amp;</span> <span class="nx">@low_pq</span><span class="p">.</span><span class="nx">unit</span> <span class="o">!=</span> <span class="nx">@high_pq</span><span class="p">.</span><span class="nx">unit</span>
      <span class="k">throw</span> <span class="s">&quot;Mismatched low and high units: &quot;</span><span class="o">+</span><span class="nx">@low_pq</span><span class="p">.</span><span class="nx">unit</span><span class="o">+</span><span class="s">&quot;, &quot;</span><span class="o">+</span><span class="nx">@high_pq</span><span class="p">.</span><span class="nx">unit</span>
  <span class="nv">unit: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@low_pq</span>
      <span class="nx">@low_pq</span><span class="p">.</span><span class="nx">unit</span>
    <span class="k">else</span>
      <span class="nx">@high_pq</span><span class="p">.</span><span class="nx">unit</span>
  <span class="nv">match: </span><span class="nf">(scalarOrHash) -&gt;</span>
    <span class="nv">val = </span><span class="nx">fieldOrContainerValue</span><span class="p">(</span><span class="nx">scalarOrHash</span><span class="p">,</span> <span class="s">&#39;scalar&#39;</span><span class="p">)</span>
    <span class="p">(</span><span class="o">!</span><span class="nx">@low_pq</span><span class="o">?</span> <span class="o">||</span> <span class="nx">@low_pq</span><span class="p">.</span><span class="nx">lessThan</span><span class="p">(</span><span class="nx">val</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">@high_pq</span><span class="o">?</span> <span class="o">||</span> <span class="nx">@high_pq</span><span class="p">.</span><span class="nx">greaterThan</span><span class="p">(</span><span class="nx">val</span><span class="p">))</span>
<span class="vi">@IVL_PQ = </span><span class="nx">IVL_PQ</span>
    
<span class="k">class</span> <span class="nx">IVL_TS</span>
  <span class="nv">constructor: </span><span class="nf">(@low, @high) -&gt;</span>
  <span class="nv">add: </span><span class="nf">(pq) -&gt;</span>
    <span class="nx">@low</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pq</span><span class="p">)</span>
    <span class="nx">@high</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pq</span><span class="p">)</span>
    <span class="k">this</span>
  <span class="nv">DURING: </span><span class="nf">(other) -&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">SDU</span><span class="p">(</span><span class="nx">other</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">EDU</span><span class="p">(</span><span class="nx">other</span><span class="p">)</span>
  <span class="nv">OVERLAP: </span><span class="nf">(other) -&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">SDU</span><span class="p">(</span><span class="nx">other</span><span class="p">)</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">EDU</span><span class="p">(</span><span class="nx">other</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">SBS</span><span class="p">(</span><span class="nx">other</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">EAE</span><span class="p">(</span><span class="nx">other</span><span class="p">))</span>
  <span class="nv">SBS: </span><span class="nf">(other) -&gt;</span> <span class="nx">@low</span><span class="p">.</span><span class="nx">before</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">low</span><span class="p">)</span>
  <span class="nv">SAS: </span><span class="nf">(other) -&gt;</span> <span class="nx">@low</span><span class="p">.</span><span class="nx">after</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">low</span><span class="p">)</span>
  <span class="nv">SBE: </span><span class="nf">(other) -&gt;</span> <span class="nx">@low</span><span class="p">.</span><span class="nx">before</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">high</span><span class="p">)</span>
  <span class="nv">SAE: </span><span class="nf">(other) -&gt;</span> <span class="nx">@low</span><span class="p">.</span><span class="nx">after</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">high</span><span class="p">)</span>
  <span class="nv">EBS: </span><span class="nf">(other) -&gt;</span> <span class="nx">@high</span><span class="p">.</span><span class="nx">before</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">low</span><span class="p">)</span>
  <span class="nv">EAS: </span><span class="nf">(other) -&gt;</span> <span class="nx">@high</span><span class="p">.</span><span class="nx">after</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">low</span><span class="p">)</span>
  <span class="nv">EBE: </span><span class="nf">(other) -&gt;</span> <span class="nx">@high</span><span class="p">.</span><span class="nx">before</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">high</span><span class="p">)</span>
  <span class="nv">EAE: </span><span class="nf">(other) -&gt;</span> <span class="nx">@high</span><span class="p">.</span><span class="nx">after</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">high</span><span class="p">)</span>
  <span class="nv">SDU: </span><span class="nf">(other) -&gt;</span> <span class="nx">@low</span><span class="p">.</span><span class="nx">afterOrConcurrent</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">low</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">@low</span><span class="p">.</span><span class="nx">beforeOrConcurrent</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">high</span><span class="p">)</span>
  <span class="nv">EDU: </span><span class="nf">(other) -&gt;</span> <span class="nx">@high</span><span class="p">.</span><span class="nx">afterOrConcurrent</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">low</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">@high</span><span class="p">.</span><span class="nx">beforeOrConcurrent</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">high</span><span class="p">)</span>
  <span class="nv">ECW: </span><span class="nf">(other) -&gt;</span> <span class="nx">@high</span><span class="p">.</span><span class="nx">asDate</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">other</span><span class="p">.</span><span class="nx">high</span><span class="p">.</span><span class="nx">asDate</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">@high</span><span class="p">.</span><span class="nx">withinSameMinute</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">high</span><span class="p">)</span>
  <span class="nv">SCW: </span><span class="nf">(other) -&gt;</span> <span class="nx">@low</span><span class="p">.</span><span class="nx">asDate</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">other</span><span class="p">.</span><span class="nx">low</span><span class="p">.</span><span class="nx">asDate</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">@low</span><span class="p">.</span><span class="nx">withinSameMinute</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">low</span><span class="p">)</span>
  <span class="nv">ECWS: </span><span class="nf">(other) -&gt;</span> <span class="nx">@high</span><span class="p">.</span><span class="nx">asDate</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">other</span><span class="p">.</span><span class="nx">low</span><span class="p">.</span><span class="nx">asDate</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">@high</span><span class="p">.</span><span class="nx">withinSameMinute</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">low</span><span class="p">)</span>
  <span class="nv">SCWE: </span><span class="nf">(other) -&gt;</span> <span class="nx">@low</span><span class="p">.</span><span class="nx">asDate</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">other</span><span class="p">.</span><span class="nx">high</span><span class="p">.</span><span class="nx">asDate</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">@low</span><span class="p">.</span><span class="nx">withinSameMinute</span><span class="p">(</span><span class="nx">other</span><span class="p">.</span><span class="nx">high</span><span class="p">)</span>
  <span class="nv">CONCURRENT: </span><span class="nf">(other) -&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">SCW</span><span class="p">(</span><span class="nx">other</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">ECW</span><span class="p">(</span><span class="nx">other</span><span class="p">)</span>
<span class="vi">@IVL_TS = </span><span class="nx">IVL_TS</span>

<span class="k">class</span> <span class="nx">ANYNonNull</span>
  <span class="nv">constructor: </span><span class="o">-&gt;</span>
  <span class="nv">match: </span><span class="nf">(scalarOrHash) -&gt;</span>
    <span class="nv">val = </span><span class="nx">fieldOrContainerValue</span><span class="p">(</span><span class="nx">scalarOrHash</span><span class="p">,</span> <span class="s">&#39;scalar&#39;</span><span class="p">)</span>
    <span class="nx">val</span> <span class="o">!=</span> <span class="kc">null</span>
<span class="vi">@ANYNonNull = </span><span class="nx">ANYNonNull</span>

<span class="nv">atLeastOneTrue = </span><span class="nf">(values...) -&gt;</span>
  <span class="nv">trueValues = </span><span class="p">(</span><span class="nx">value</span> <span class="k">for</span> <span class="nx">value</span> <span class="k">in</span> <span class="nx">values</span> <span class="k">when</span> <span class="nx">value</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span><span class="p">.</span><span class="nx">isTrue</span><span class="p">())</span>
  <span class="nx">trueValues</span><span class="p">.</span><span class="nx">length</span><span class="o">&gt;</span><span class="mi">0</span>
  <span class="nx">Specifics</span><span class="p">.</span><span class="nx">unionAll</span><span class="p">(</span><span class="k">new</span> <span class="nb">Boolean</span><span class="p">(</span><span class="nx">trueValues</span><span class="p">.</span><span class="nx">length</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">),</span> <span class="nx">values</span><span class="p">)</span>
<span class="vi">@atLeastOneTrue = </span><span class="nx">atLeastOneTrue</span>
  
<span class="nv">allTrue = </span><span class="nf">(values...) -&gt;</span>
  <span class="nv">trueValues = </span><span class="p">(</span><span class="nx">value</span> <span class="k">for</span> <span class="nx">value</span> <span class="k">in</span> <span class="nx">values</span> <span class="k">when</span> <span class="nx">value</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span><span class="p">.</span><span class="nx">isTrue</span><span class="p">())</span>
  <span class="nx">Specifics</span><span class="p">.</span><span class="nx">intersectAll</span><span class="p">(</span><span class="k">new</span> <span class="nb">Boolean</span><span class="p">(</span><span class="nx">trueValues</span><span class="p">.</span><span class="nx">length</span><span class="o">&gt;</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">trueValues</span><span class="p">.</span><span class="nx">length</span><span class="o">==</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="p">),</span> <span class="nx">values</span><span class="p">)</span>
<span class="vi">@allTrue = </span><span class="nx">allTrue</span>
  
<span class="nv">atLeastOneFalse = </span><span class="nf">(values...) -&gt;</span>
  <span class="nv">falseValues = </span><span class="p">(</span><span class="nx">value</span> <span class="k">for</span> <span class="nx">value</span> <span class="k">in</span> <span class="nx">values</span> <span class="k">when</span> <span class="nx">value</span><span class="p">.</span><span class="nx">isFalse</span><span class="p">())</span>
  <span class="nx">Specifics</span><span class="p">.</span><span class="nx">intersectAll</span><span class="p">(</span><span class="k">new</span> <span class="nb">Boolean</span><span class="p">(</span><span class="nx">falseValues</span><span class="p">.</span><span class="nx">length</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">),</span> <span class="nx">values</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
<span class="vi">@atLeastOneFalse = </span><span class="nx">atLeastOneFalse</span>
  
<span class="nv">allFalse = </span><span class="nf">(values...) -&gt;</span>
  <span class="nv">falseValues = </span><span class="p">(</span><span class="nx">value</span> <span class="k">for</span> <span class="nx">value</span> <span class="k">in</span> <span class="nx">values</span> <span class="k">when</span> <span class="nx">value</span><span class="p">.</span><span class="nx">isFalse</span><span class="p">())</span>
  <span class="nx">Specifics</span><span class="p">.</span><span class="nx">unionAll</span><span class="p">(</span><span class="k">new</span> <span class="nb">Boolean</span><span class="p">(</span><span class="nx">falseValues</span><span class="p">.</span><span class="nx">length</span><span class="o">&gt;</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">falseValues</span><span class="p">.</span><span class="nx">length</span><span class="o">==</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="p">),</span> <span class="nx">values</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
<span class="vi">@allFalse = </span><span class="nx">allFalse</span>
  
<span class="nv">matchingValue = </span><span class="nf">(value, compareTo) -&gt;</span>
  <span class="k">new</span> <span class="nb">Boolean</span><span class="p">(</span><span class="nx">compareTo</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span>
<span class="vi">@matchingValue = </span><span class="nx">matchingValue</span>

<span class="nv">anyMatchingValue = </span><span class="nf">(event, valueToMatch) -&gt;</span>
  <span class="nv">matchingValues = </span><span class="p">(</span><span class="nx">value</span> <span class="k">for</span> <span class="nx">value</span> <span class="k">in</span> <span class="nx">event</span><span class="p">.</span><span class="nx">values</span><span class="p">()</span> <span class="k">when</span> <span class="p">(</span><span class="nx">valueToMatch</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">value</span><span class="p">)))</span>
  <span class="nx">matchingValues</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="vi">@anyMatchingValue = </span><span class="nx">anyMatchingValue</span>

<span class="nv">filterEventsByValue = </span><span class="nf">(events, value) -&gt;</span>
  <span class="nv">matchingEvents = </span><span class="p">(</span><span class="nx">event</span> <span class="k">for</span> <span class="nx">event</span> <span class="k">in</span> <span class="nx">events</span> <span class="k">when</span> <span class="p">(</span><span class="nx">anyMatchingValue</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">value</span><span class="p">)))</span>
  <span class="nx">matchingEvents</span>
<span class="vi">@filterEventsByValue = </span><span class="nx">filterEventsByValue</span>

<span class="nv">filterEventsByField = </span><span class="nf">(events, field, value) -&gt;</span>
  <span class="nv">respondingEvents = </span><span class="p">(</span><span class="nx">event</span> <span class="k">for</span> <span class="nx">event</span> <span class="k">in</span> <span class="nx">events</span> <span class="k">when</span> <span class="nx">event</span><span class="p">.</span><span class="nx">respondTo</span><span class="p">(</span><span class="nx">field</span><span class="p">))</span>
  <span class="nx">event</span> <span class="k">for</span> <span class="nx">event</span> <span class="k">in</span> <span class="nx">respondingEvents</span> <span class="k">when</span> <span class="nx">value</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">event</span><span class="p">[</span><span class="nx">field</span><span class="p">]())</span>
<span class="vi">@filterEventsByField = </span><span class="nx">filterEventsByField</span>

<span class="nv">getCodes = </span><span class="nf">(oid) -&gt;</span>
  <span class="nx">OidDictionary</span><span class="p">[</span><span class="nx">oid</span><span class="p">]</span>
<span class="vi">@getCodes = </span><span class="nx">getCodes</span></pre></div>
      </td>
    </tr>
    <tr id='section-33'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-33">&#182;</a>
        </div>
        <p>Used for representing XPRODUCTs of arrays, holds both a flattened array that contains
all the elements of the compoent arrays and the component arrays themselves</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="k">class</span> <span class="nx">CrossProduct</span> <span class="k">extends</span> <span class="nb">Array</span>
  <span class="nv">constructor: </span><span class="nf">(allEventLists) -&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@eventLists = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">eventList</span> <span class="k">in</span> <span class="nx">allEventLists</span>
      <span class="nx">@eventLists</span><span class="p">.</span><span class="nx">push</span> <span class="nx">eventList</span>
      <span class="k">for</span> <span class="nx">event</span> <span class="k">in</span> <span class="nx">eventList</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span>

<span class="nv">XPRODUCT = </span><span class="nf">(eventLists...) -&gt;</span>
  <span class="nx">Specifics</span><span class="p">.</span><span class="nx">intersectAll</span><span class="p">(</span><span class="k">new</span> <span class="nx">CrossProduct</span><span class="p">(</span><span class="nx">eventLists</span><span class="p">),</span> <span class="nx">eventLists</span><span class="p">)</span>
<span class="vi">@XPRODUCT = </span><span class="nx">XPRODUCT</span>

<span class="nv">UNION = </span><span class="nf">(eventLists...) -&gt;</span>
  <span class="nv">union = </span><span class="p">[]</span>
  <span class="k">for</span> <span class="nx">eventList</span> <span class="k">in</span> <span class="nx">eventLists</span>
    <span class="k">for</span> <span class="nx">event</span> <span class="k">in</span> <span class="nx">eventList</span>
      <span class="nx">union</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span>
  <span class="nx">Specifics</span><span class="p">.</span><span class="nx">unionAll</span><span class="p">(</span><span class="nx">union</span><span class="p">,</span> <span class="nx">eventLists</span><span class="p">)</span>
<span class="vi">@UNION = </span><span class="nx">UNION</span>

<span class="nv">COUNT = </span><span class="nf">(events, range) -&gt;</span>
  <span class="nv">count = </span><span class="nx">events</span><span class="p">.</span><span class="nx">length</span>
  <span class="nv">result = </span><span class="k">new</span> <span class="nb">Boolean</span><span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">count</span><span class="p">))</span>
  <span class="nx">applySpecificOccurrenceSubset</span><span class="p">(</span><span class="s">&#39;COUNT&#39;</span><span class="p">,</span> <span class="nx">Specifics</span><span class="p">.</span><span class="nx">maintainSpecifics</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">events</span><span class="p">),</span> <span class="nx">range</span><span class="p">)</span>
<span class="vi">@COUNT = </span><span class="nx">COUNT</span>

<span class="nv">PREVSUM = </span><span class="nf">(eventList) -&gt;</span>
  <span class="nx">eventList</span>
<span class="vi">@PREVSUM = </span><span class="nx">PREVSUM</span>

<span class="nv">getIVL = </span><span class="nf">(eventOrTimeStamp) -&gt;</span>
  <span class="k">if</span> <span class="nx">eventOrTimeStamp</span><span class="p">.</span><span class="nx">asIVL_TS</span>
    <span class="nx">eventOrTimeStamp</span><span class="p">.</span><span class="nx">asIVL_TS</span><span class="p">()</span>
  <span class="k">else</span>
    <span class="nv">ts = </span><span class="k">new</span> <span class="nx">TS</span><span class="p">()</span>
    <span class="nv">ts.date = </span><span class="nx">eventOrTimeStamp</span>
    <span class="k">new</span> <span class="nx">IVL_TS</span><span class="p">(</span><span class="nx">ts</span><span class="p">,</span> <span class="nx">ts</span><span class="p">)</span>
<span class="vi">@getIVL = </span><span class="nx">getIVL</span>
    </pre></div>
      </td>
    </tr>
    <tr id='section-34'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-34">&#182;</a>
        </div>
        <p>should DURING and CONCURRENT be an error ?</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nv">eventAccessor = </span><span class="p">{</span>  
  <span class="s">&#39;DURING&#39;</span><span class="o">:</span> <span class="s">&#39;low&#39;</span><span class="p">,</span>
  <span class="s">&#39;OVERLAP&#39;</span><span class="o">:</span> <span class="s">&#39;low&#39;</span><span class="p">,</span>
  <span class="s">&#39;SBS&#39;</span><span class="o">:</span> <span class="s">&#39;low&#39;</span><span class="p">,</span>
  <span class="s">&#39;SAS&#39;</span><span class="o">:</span> <span class="s">&#39;low&#39;</span><span class="p">,</span>
  <span class="s">&#39;SBE&#39;</span><span class="o">:</span> <span class="s">&#39;low&#39;</span><span class="p">,</span>
  <span class="s">&#39;SAE&#39;</span><span class="o">:</span> <span class="s">&#39;low&#39;</span><span class="p">,</span>
  <span class="s">&#39;EBS&#39;</span><span class="o">:</span> <span class="s">&#39;high&#39;</span><span class="p">,</span>
  <span class="s">&#39;EAS&#39;</span><span class="o">:</span> <span class="s">&#39;high&#39;</span><span class="p">,</span>
  <span class="s">&#39;EBE&#39;</span><span class="o">:</span> <span class="s">&#39;high&#39;</span><span class="p">,</span>
  <span class="s">&#39;EAE&#39;</span><span class="o">:</span> <span class="s">&#39;high&#39;</span><span class="p">,</span>
  <span class="s">&#39;SDU&#39;</span><span class="o">:</span> <span class="s">&#39;low&#39;</span><span class="p">,</span>
  <span class="s">&#39;EDU&#39;</span><span class="o">:</span> <span class="s">&#39;high&#39;</span><span class="p">,</span>
  <span class="s">&#39;ECW&#39;</span><span class="o">:</span> <span class="s">&#39;high&#39;</span>
  <span class="s">&#39;SCW&#39;</span><span class="o">:</span> <span class="s">&#39;low&#39;</span><span class="p">,</span>
  <span class="s">&#39;ECWS&#39;</span><span class="o">:</span> <span class="s">&#39;high&#39;</span>
  <span class="s">&#39;SCWE&#39;</span><span class="o">:</span> <span class="s">&#39;low&#39;</span><span class="p">,</span>
  <span class="s">&#39;CONCURRENT&#39;</span><span class="o">:</span> <span class="s">&#39;low&#39;</span>
<span class="p">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-35'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-35">&#182;</a>
        </div>
        <p>should DURING SDU, EDU, ECW, SCW and CONCURRENT be an error ?</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nv">boundAccessor = </span><span class="p">{</span>  
  <span class="s">&#39;DURING&#39;</span><span class="o">:</span> <span class="s">&#39;low&#39;</span><span class="p">,</span>
  <span class="s">&#39;OVERLAP&#39;</span><span class="o">:</span> <span class="s">&#39;low&#39;</span><span class="p">,</span>
  <span class="s">&#39;SBS&#39;</span><span class="o">:</span> <span class="s">&#39;low&#39;</span><span class="p">,</span>
  <span class="s">&#39;SAS&#39;</span><span class="o">:</span> <span class="s">&#39;low&#39;</span><span class="p">,</span>
  <span class="s">&#39;SBE&#39;</span><span class="o">:</span> <span class="s">&#39;high&#39;</span><span class="p">,</span>
  <span class="s">&#39;SAE&#39;</span><span class="o">:</span> <span class="s">&#39;high&#39;</span><span class="p">,</span>
  <span class="s">&#39;EBS&#39;</span><span class="o">:</span> <span class="s">&#39;low&#39;</span><span class="p">,</span>
  <span class="s">&#39;EAS&#39;</span><span class="o">:</span> <span class="s">&#39;low&#39;</span><span class="p">,</span>
  <span class="s">&#39;EBE&#39;</span><span class="o">:</span> <span class="s">&#39;high&#39;</span><span class="p">,</span>
  <span class="s">&#39;EAE&#39;</span><span class="o">:</span> <span class="s">&#39;high&#39;</span><span class="p">,</span>
  <span class="s">&#39;SDU&#39;</span><span class="o">:</span> <span class="s">&#39;low&#39;</span><span class="p">,</span>
  <span class="s">&#39;EDU&#39;</span><span class="o">:</span> <span class="s">&#39;low&#39;</span><span class="p">,</span>
  <span class="s">&#39;ECW&#39;</span><span class="o">:</span> <span class="s">&#39;high&#39;</span>
  <span class="s">&#39;SCW&#39;</span><span class="o">:</span> <span class="s">&#39;low&#39;</span><span class="p">,</span>
  <span class="s">&#39;ECWS&#39;</span><span class="o">:</span> <span class="s">&#39;low&#39;</span>
  <span class="s">&#39;SCWE&#39;</span><span class="o">:</span> <span class="s">&#39;high&#39;</span><span class="p">,</span>
  <span class="s">&#39;CONCURRENT&#39;</span><span class="o">:</span> <span class="s">&#39;low&#39;</span>
<span class="p">}</span>
    
<span class="nv">withinRange = </span><span class="nf">(method, eventIVL, boundIVL, range) -&gt;</span>
  <span class="nv">eventTS = </span><span class="nx">eventIVL</span><span class="p">[</span><span class="nx">eventAccessor</span><span class="p">[</span><span class="nx">method</span><span class="p">]]</span>
  <span class="nv">boundTS = </span><span class="nx">boundIVL</span><span class="p">[</span><span class="nx">boundAccessor</span><span class="p">[</span><span class="nx">method</span><span class="p">]]</span>
  <span class="nx">range</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">eventTS</span><span class="p">.</span><span class="nx">difference</span><span class="p">(</span><span class="nx">boundTS</span><span class="p">,</span> <span class="nx">range</span><span class="p">.</span><span class="nx">unit</span><span class="p">()))</span>
<span class="vi">@withinRange = </span><span class="nx">withinRange</span>
    
<span class="nv">eventMatchesBounds = </span><span class="nf">(event, bounds, methodName, range) -&gt;</span>
  <span class="k">if</span> <span class="nx">bounds</span><span class="p">.</span><span class="nx">eventLists</span></pre></div>
      </td>
    </tr>
    <tr id='section-36'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-36">&#182;</a>
        </div>
        <p>XPRODUCT set of bounds &ndash; event must match at least one bound in all members</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nv">matchingBounds = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">boundList</span> <span class="k">in</span> <span class="nx">bounds</span><span class="p">.</span><span class="nx">eventLists</span>
      <span class="nv">currentMatches = </span><span class="nx">eventMatchesBounds</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">boundList</span><span class="p">,</span> <span class="nx">methodName</span><span class="p">,</span> <span class="nx">range</span><span class="p">)</span>
      <span class="k">return</span> <span class="p">[]</span> <span class="k">if</span> <span class="p">(</span><span class="nx">currentMatches</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nv">matchingBounds = </span><span class="nx">matchingBounds</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">currentMatches</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">Specifics</span><span class="p">.</span><span class="nx">maintainSpecifics</span><span class="p">(</span><span class="nx">matchingBounds</span><span class="p">,</span><span class="nx">bounds</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="nv">eventIVL = </span><span class="nx">getIVL</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span>
    <span class="nv">matchingBounds = </span><span class="p">(</span><span class="nx">bound</span> <span class="k">for</span> <span class="nx">bound</span> <span class="k">in</span> <span class="nx">bounds</span> <span class="k">when</span> <span class="p">(</span>
      <span class="nv">boundIVL = </span><span class="nx">getIVL</span><span class="p">(</span><span class="nx">bound</span><span class="p">)</span>
      <span class="nv">result = </span><span class="nx">eventIVL</span><span class="p">[</span><span class="nx">methodName</span><span class="p">](</span><span class="nx">boundIVL</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">result</span> <span class="o">&amp;&amp;</span> <span class="nx">range</span>
        <span class="nx">result</span> <span class="o">&amp;&amp;=</span> <span class="nx">withinRange</span><span class="p">(</span><span class="nx">methodName</span><span class="p">,</span> <span class="nx">eventIVL</span><span class="p">,</span> <span class="nx">boundIVL</span><span class="p">,</span> <span class="nx">range</span><span class="p">)</span>
      <span class="nx">result</span>
    <span class="p">))</span>
    <span class="nx">Specifics</span><span class="p">.</span><span class="nx">maintainSpecifics</span><span class="p">(</span><span class="nx">matchingBounds</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">)</span>
<span class="vi">@eventMatchesBounds = </span><span class="nx">eventMatchesBounds</span>
  
<span class="nv">eventsMatchBounds = </span><span class="nf">(events, bounds, methodName, range) -&gt;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">length</span><span class="o">==</span><span class="kc">undefined</span><span class="p">)</span>
    <span class="nv">bounds = </span><span class="p">[</span><span class="nx">bounds</span><span class="p">]</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">length</span><span class="o">==</span><span class="kc">undefined</span><span class="p">)</span>
    <span class="nv">events = </span><span class="p">[</span><span class="nx">events</span><span class="p">]</span>
  
  <span class="nv">specificContext = </span><span class="k">new</span> <span class="nx">Specifics</span><span class="p">()</span>
  <span class="nv">hasSpecificOccurrence = </span><span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">specific_occurrence</span><span class="o">?</span> <span class="o">||</span> <span class="nx">bounds</span><span class="p">.</span><span class="nx">specific_occurrence</span><span class="o">?</span><span class="p">)</span>
  <span class="nv">matchingEvents = </span><span class="p">[]</span>
  <span class="nv">matchingEvents.specific_occurrence = </span><span class="nx">events</span><span class="p">.</span><span class="nx">specific_occurrence</span>
  <span class="k">for</span> <span class="nx">event</span> <span class="k">in</span> <span class="nx">events</span>
    <span class="nx">matchingBounds</span><span class="o">=</span><span class="nx">eventMatchesBounds</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">,</span> <span class="nx">methodName</span><span class="p">,</span> <span class="nx">range</span><span class="p">)</span>
    <span class="nx">matchingEvents</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="k">if</span> <span class="nx">matchingBounds</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="nx">hasSpecificOccurrence</span>
      <span class="nv">matchingEvents.specific_occurrence = </span><span class="nx">events</span><span class="p">.</span><span class="nx">specific_occurrence</span></pre></div>
      </td>
    </tr>
    <tr id='section-37'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-37">&#182;</a>
        </div>
        <p>TODO: we&rsquo;ll need a temporary variable for non specific occurrences on the left so that we can do rejections based on restrictions in the data criteria</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="nx">specificContext</span><span class="p">.</span><span class="nx">addRows</span><span class="p">(</span><span class="nx">Row</span><span class="p">.</span><span class="nx">buildRowsForMatching</span><span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">specific_occurrence</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">.</span><span class="nx">specific_occurrence</span><span class="p">,</span> <span class="nx">matchingBounds</span><span class="p">))</span>
    <span class="k">else</span></pre></div>
      </td>
    </tr>
    <tr id='section-38'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-38">&#182;</a>
        </div>
        <p>add all stars</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="nx">specificContext</span><span class="p">.</span><span class="nx">addIdentityRow</span><span class="p">()</span>
  
  <span class="nv">matchingEvents.specificContext = </span><span class="nx">specificContext</span><span class="p">.</span><span class="nx">finalizeEvents</span><span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">specificContext</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">.</span><span class="nx">specificContext</span><span class="p">)</span>
  
  <span class="nx">matchingEvents</span>
<span class="vi">@eventsMatchBounds = </span><span class="nx">eventsMatchBounds</span>
  
<span class="nv">DURING = </span><span class="nf">(events, bounds, offset) -&gt;</span>
  <span class="nx">eventsMatchBounds</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">,</span> <span class="s">&quot;DURING&quot;</span><span class="p">,</span> <span class="nx">offset</span><span class="p">)</span>
<span class="vi">@DURING = </span><span class="nx">DURING</span>

<span class="nv">OVERLAP = </span><span class="nf">(events, bounds, offset) -&gt;</span>
  <span class="nx">eventsMatchBounds</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">,</span> <span class="s">&quot;OVERLAP&quot;</span><span class="p">,</span> <span class="nx">offset</span><span class="p">)</span>
<span class="vi">@OVERLAP = </span><span class="nx">OVERLAP</span>

<span class="nv">SBS = </span><span class="nf">(events, bounds, offset) -&gt;</span>
  <span class="nx">eventsMatchBounds</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">,</span> <span class="s">&quot;SBS&quot;</span><span class="p">,</span> <span class="nx">offset</span><span class="p">)</span>
<span class="vi">@SBS = </span><span class="nx">SBS</span>

<span class="nv">SAS = </span><span class="nf">(events, bounds, offset) -&gt;</span>
  <span class="nx">eventsMatchBounds</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">,</span> <span class="s">&quot;SAS&quot;</span><span class="p">,</span> <span class="nx">offset</span><span class="p">)</span>
<span class="vi">@SAS = </span><span class="nx">SAS</span>

<span class="nv">SBE = </span><span class="nf">(events, bounds, offset) -&gt;</span>
  <span class="nx">eventsMatchBounds</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">,</span> <span class="s">&quot;SBE&quot;</span><span class="p">,</span> <span class="nx">offset</span><span class="p">)</span>
<span class="vi">@SBE = </span><span class="nx">SBE</span>

<span class="nv">SAE = </span><span class="nf">(events, bounds, offset) -&gt;</span>
  <span class="nx">eventsMatchBounds</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">,</span> <span class="s">&quot;SAE&quot;</span><span class="p">,</span> <span class="nx">offset</span><span class="p">)</span>
<span class="vi">@SAE = </span><span class="nx">SAE</span>

<span class="nv">EBS = </span><span class="nf">(events, bounds, offset) -&gt;</span>
  <span class="nx">eventsMatchBounds</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">,</span> <span class="s">&quot;EBS&quot;</span><span class="p">,</span> <span class="nx">offset</span><span class="p">)</span>
<span class="vi">@EBS = </span><span class="nx">EBS</span>

<span class="nv">EAS = </span><span class="nf">(events, bounds, offset) -&gt;</span>
  <span class="nx">eventsMatchBounds</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">,</span> <span class="s">&quot;EAS&quot;</span><span class="p">,</span> <span class="nx">offset</span><span class="p">)</span>
<span class="vi">@EAS = </span><span class="nx">EAS</span>

<span class="nv">EBE = </span><span class="nf">(events, bounds, offset) -&gt;</span>
  <span class="nx">eventsMatchBounds</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">,</span> <span class="s">&quot;EBE&quot;</span><span class="p">,</span> <span class="nx">offset</span><span class="p">)</span>
<span class="vi">@EBE = </span><span class="nx">EBE</span>

<span class="nv">EAE = </span><span class="nf">(events, bounds, offset) -&gt;</span>
  <span class="nx">eventsMatchBounds</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">,</span> <span class="s">&quot;EAE&quot;</span><span class="p">,</span> <span class="nx">offset</span><span class="p">)</span>
<span class="vi">@EAE = </span><span class="nx">EAE</span>

<span class="nv">SDU = </span><span class="nf">(events, bounds, offset) -&gt;</span>
  <span class="nx">eventsMatchBounds</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">,</span> <span class="s">&quot;SDU&quot;</span><span class="p">,</span> <span class="nx">offset</span><span class="p">)</span>
<span class="vi">@SDU = </span><span class="nx">SDU</span>

<span class="nv">EDU = </span><span class="nf">(events, bounds, offset) -&gt;</span>
  <span class="nx">eventsMatchBounds</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">,</span> <span class="s">&quot;EDU&quot;</span><span class="p">,</span> <span class="nx">offset</span><span class="p">)</span>
<span class="vi">@EDU = </span><span class="nx">EDU</span>

<span class="nv">ECW = </span><span class="nf">(events, bounds, offset) -&gt;</span>
  <span class="nx">eventsMatchBounds</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">,</span> <span class="s">&quot;ECW&quot;</span><span class="p">,</span> <span class="nx">offset</span><span class="p">)</span>
<span class="vi">@ECW = </span><span class="nx">ECW</span>
  
<span class="nv">SCW = </span><span class="nf">(events, bounds, offset) -&gt;</span>
  <span class="nx">eventsMatchBounds</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">,</span> <span class="s">&quot;SCW&quot;</span><span class="p">,</span> <span class="nx">offset</span><span class="p">)</span>
<span class="vi">@SCW = </span><span class="nx">SCW</span>

<span class="nv">ECWS = </span><span class="nf">(events, bounds, offset) -&gt;</span>
  <span class="nx">eventsMatchBounds</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">,</span> <span class="s">&quot;ECWS&quot;</span><span class="p">,</span> <span class="nx">offset</span><span class="p">)</span>
<span class="vi">@ECWS = </span><span class="nx">ECWS</span>
  
<span class="nv">SCWE = </span><span class="nf">(events, bounds, offset) -&gt;</span>
  <span class="nx">eventsMatchBounds</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">,</span> <span class="s">&quot;SCWE&quot;</span><span class="p">,</span> <span class="nx">offset</span><span class="p">)</span>
<span class="vi">@SCWE = </span><span class="nx">SCWE</span>

<span class="nv">CONCURRENT = </span><span class="nf">(events, bounds, offset) -&gt;</span>
  <span class="nx">eventsMatchBounds</span><span class="p">(</span><span class="nx">events</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">,</span> <span class="s">&quot;CONCURRENT&quot;</span><span class="p">,</span> <span class="nx">offset</span><span class="p">)</span>
<span class="vi">@CONCURRENT = </span><span class="nx">CONCURRENT</span>

<span class="nv">dateSortDescending = </span><span class="nf">(a, b) -&gt;</span>
  <span class="nx">b</span><span class="p">.</span><span class="nx">timeStamp</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">-</span> <span class="nx">a</span><span class="p">.</span><span class="nx">timeStamp</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span>
<span class="vi">@dateSortDescending= </span><span class="nx">dateSortDescending</span>

<span class="nv">dateSortAscending = </span><span class="nf">(a, b) -&gt;</span>
  <span class="nx">a</span><span class="p">.</span><span class="nx">timeStamp</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">-</span> <span class="nx">b</span><span class="p">.</span><span class="nx">timeStamp</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span>
<span class="vi">@dateSortAscending = </span><span class="nx">dateSortAscending</span>

<span class="nv">applySpecificOccurrenceSubset = </span><span class="nf">(operator, result, range, calculateSpecifics) -&gt;</span></pre></div>
      </td>
    </tr>
    <tr id='section-39'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-39">&#182;</a>
        </div>
        <p>the subset operators are re-used in the specifics calculation of those operators.  Checking for a specificContext
prevents entering into an infinite loop here.</p>

      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">specificContext</span><span class="o">?</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">range</span><span class="o">?</span><span class="p">)</span>
      <span class="nv">result.specificContext = </span><span class="nx">result</span><span class="p">.</span><span class="nx">specificContext</span><span class="p">[</span><span class="nx">operator</span><span class="p">](</span><span class="nx">range</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">result.specificContext = </span><span class="nx">result</span><span class="p">.</span><span class="nx">specificContext</span><span class="p">[</span><span class="nx">operator</span><span class="p">]()</span>
  <span class="nx">result</span>

<span class="nv">FIRST = </span><span class="nf">(events) -&gt;</span>
  <span class="nv">result = </span><span class="p">[]</span>
  <span class="nv">result = </span><span class="p">[</span><span class="nx">events</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">dateSortAscending</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">if</span> <span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
  <span class="nx">applySpecificOccurrenceSubset</span><span class="p">(</span><span class="s">&#39;FIRST&#39;</span><span class="p">,</span><span class="nx">Specifics</span><span class="p">.</span><span class="nx">maintainSpecifics</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">events</span><span class="p">))</span>
<span class="vi">@FIRST = </span><span class="nx">FIRST</span>

<span class="nv">SECOND = </span><span class="nf">(events) -&gt;</span>
  <span class="nv">result = </span><span class="p">[]</span>
  <span class="nv">result = </span><span class="p">[</span><span class="nx">events</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">dateSortAscending</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">if</span> <span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
  <span class="nx">applySpecificOccurrenceSubset</span><span class="p">(</span><span class="s">&#39;SECOND&#39;</span><span class="p">,</span><span class="nx">Specifics</span><span class="p">.</span><span class="nx">maintainSpecifics</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">events</span><span class="p">))</span>
<span class="vi">@SECOND = </span><span class="nx">SECOND</span>

<span class="nv">THIRD = </span><span class="nf">(events) -&gt;</span>
  <span class="nv">result = </span><span class="p">[]</span>
  <span class="nv">result = </span><span class="p">[</span><span class="nx">events</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">dateSortAscending</span><span class="p">)[</span><span class="mi">2</span><span class="p">]]</span> <span class="k">if</span> <span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>
  <span class="nx">applySpecificOccurrenceSubset</span><span class="p">(</span><span class="s">&#39;THIRD&#39;</span><span class="p">,</span><span class="nx">Specifics</span><span class="p">.</span><span class="nx">maintainSpecifics</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">events</span><span class="p">))</span>
<span class="vi">@THIRD = </span><span class="nx">THIRD</span>

<span class="nv">FOURTH = </span><span class="nf">(events) -&gt;</span>
  <span class="nv">result = </span><span class="p">[]</span>
  <span class="nv">result = </span><span class="p">[</span><span class="nx">events</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">dateSortAscending</span><span class="p">)[</span><span class="mi">3</span><span class="p">]]</span> <span class="k">if</span> <span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span>
  <span class="nx">applySpecificOccurrenceSubset</span><span class="p">(</span><span class="s">&#39;FOURTH&#39;</span><span class="p">,</span><span class="nx">Specifics</span><span class="p">.</span><span class="nx">maintainSpecifics</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">events</span><span class="p">))</span>
<span class="vi">@FOURTH = </span><span class="nx">FOURTH</span>

<span class="nv">FIFTH = </span><span class="nf">(events) -&gt;</span>
  <span class="nv">result = </span><span class="p">[]</span>
  <span class="nv">result = </span><span class="p">[</span><span class="nx">events</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">dateSortAscending</span><span class="p">)[</span><span class="mi">4</span><span class="p">]]</span> <span class="k">if</span> <span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span>
  <span class="nx">applySpecificOccurrenceSubset</span><span class="p">(</span><span class="s">&#39;FIFTH&#39;</span><span class="p">,</span><span class="nx">Specifics</span><span class="p">.</span><span class="nx">maintainSpecifics</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">events</span><span class="p">))</span>
<span class="vi">@FIFTH = </span><span class="nx">FIFTH</span>

<span class="nv">RECENT = </span><span class="nf">(events) -&gt;</span>
  <span class="nv">result = </span><span class="p">[]</span>
  <span class="nv">result = </span><span class="p">[</span><span class="nx">events</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">dateSortDescending</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">if</span> <span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
  <span class="nx">applySpecificOccurrenceSubset</span><span class="p">(</span><span class="s">&#39;RECENT&#39;</span><span class="p">,</span><span class="nx">Specifics</span><span class="p">.</span><span class="nx">maintainSpecifics</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">events</span><span class="p">))</span>
<span class="vi">@RECENT = </span><span class="nx">RECENT</span>
  
<span class="nv">LAST = </span><span class="nf">(events) -&gt;</span>
  <span class="nx">RECENT</span><span class="p">(</span><span class="nx">events</span><span class="p">)</span>
<span class="vi">@LAST = </span><span class="nx">LAST</span>
  
<span class="nv">valueSortDescending = </span><span class="nf">(a, b) -&gt;</span>
  <span class="nv">va = vb = </span><span class="kc">Infinity</span>
  <span class="k">if</span> <span class="nx">a</span><span class="p">.</span><span class="nx">value</span>
    <span class="nv">va = </span><span class="nx">a</span><span class="p">.</span><span class="nx">value</span><span class="p">()[</span><span class="s">&quot;scalar&quot;</span><span class="p">]</span>
  <span class="k">if</span> <span class="nx">b</span><span class="p">.</span><span class="nx">value</span> 
    <span class="nv">vb = </span><span class="nx">b</span><span class="p">.</span><span class="nx">value</span><span class="p">()[</span><span class="s">&quot;scalar&quot;</span><span class="p">]</span>
  <span class="k">if</span> <span class="nx">va</span><span class="o">==</span><span class="nx">vb</span>
    <span class="mi">0</span>
  <span class="k">else</span>
    <span class="nx">vb</span> <span class="o">-</span> <span class="nx">va</span>
<span class="vi">@valueSortDescending = </span><span class="nx">valueSortDescending</span>

<span class="nv">valueSortAscending = </span><span class="nf">(a, b) -&gt;</span>
  <span class="nv">va = vb = </span><span class="kc">Infinity</span>
  <span class="k">if</span> <span class="nx">a</span><span class="p">.</span><span class="nx">value</span>
    <span class="nv">va = </span><span class="nx">a</span><span class="p">.</span><span class="nx">value</span><span class="p">()[</span><span class="s">&quot;scalar&quot;</span><span class="p">]</span>
  <span class="k">if</span> <span class="nx">b</span><span class="p">.</span><span class="nx">value</span> 
    <span class="nv">vb = </span><span class="nx">b</span><span class="p">.</span><span class="nx">value</span><span class="p">()[</span><span class="s">&quot;scalar&quot;</span><span class="p">]</span>
  <span class="k">if</span> <span class="nx">va</span><span class="o">==</span><span class="nx">vb</span>
    <span class="mi">0</span>
  <span class="k">else</span>
    <span class="nx">va</span> <span class="o">-</span> <span class="nx">vb</span>
<span class="vi">@valueSortAscending = </span><span class="nx">valueSortAscending</span>

<span class="nv">MIN = </span><span class="nf">(events, range) -&gt;</span>
  <span class="nv">minValue = </span><span class="kc">Infinity</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nv">minValue = </span><span class="nx">events</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">valueSortAscending</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">()[</span><span class="s">&quot;scalar&quot;</span><span class="p">]</span>
  <span class="nv">result = </span><span class="k">new</span> <span class="nb">Boolean</span><span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">minValue</span><span class="p">))</span>
  <span class="nx">applySpecificOccurrenceSubset</span><span class="p">(</span><span class="s">&#39;MIN&#39;</span><span class="p">,</span><span class="nx">Specifics</span><span class="p">.</span><span class="nx">maintainSpecifics</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">events</span><span class="p">),</span> <span class="nx">range</span><span class="p">)</span>
<span class="vi">@MIN = </span><span class="nx">MIN</span>

<span class="nv">MAX = </span><span class="nf">(events, range) -&gt;</span>
  <span class="nv">maxValue = </span><span class="o">-</span><span class="kc">Infinity</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nv">maxValue = </span><span class="nx">events</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">valueSortDescending</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">()[</span><span class="s">&quot;scalar&quot;</span><span class="p">]</span>
  <span class="nv">result = </span><span class="k">new</span> <span class="nb">Boolean</span><span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">maxValue</span><span class="p">))</span>
  <span class="nx">applySpecificOccurrenceSubset</span><span class="p">(</span><span class="s">&#39;MAX&#39;</span><span class="p">,</span><span class="nx">Specifics</span><span class="p">.</span><span class="nx">maintainSpecifics</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">events</span><span class="p">),</span> <span class="nx">range</span><span class="p">)</span>
<span class="vi">@MAX = </span><span class="nx">MAX</span>

<span class="vi">@OidDictionary = </span><span class="p">{};</span>

<span class="nv">hqmfjs = </span><span class="nx">hqmfjs</span><span class="o">||</span><span class="p">{}</span>
<span class="vi">@hqmfjs = </span><span class="nx">@hqmfjs</span><span class="o">||</span><span class="p">{};</span></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
