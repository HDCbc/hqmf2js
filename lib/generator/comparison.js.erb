var <%= name %> = function(patient) {
  <%- data_criteria = doc.data_criteria(comparison.data_criteria_id) -%>
  // <%= data_criteria.title %>
  <%- if data_criteria.property -%>
  var eventsMatchingComparison = patient.<%= data_criteria.property %>();
  <%- else -%>
  var eventsMatchingComparison = patient.<%= data_criteria.type %>s().match(dataCriteria["<%= data_criteria.const_name %>"].codes);
  <%- if data_criteria.status -%>
  eventsMatchingComparison = filterByStatus(eventsMatchingComparison, "<%= data_criteria.status %>");
  <%- end -%>
  <%- end -%>
  
  <%- comparison.restrictions.each do |restriction| -%>
  // <%= restriction.type %> <%= doc.attribute(restriction.target_id).name %>
  eventsMatchingComparison = <%= restriction.type %>(
    attributes["<%= doc.attribute(restriction.target_id).const_name %>"],
    eventsMatchingComparison<%- -%>
    <%- if restriction.range -%>
    <%- -%>, <%= js_for_range(restriction.range) %>
    <%- end -%>
  );
  <%- end -%>
  return eventsMatchingComparison;
}