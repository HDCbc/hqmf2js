var <%= name %> = function(patient) {
  <%- fns = [] -%>
  <%- precondition.preconditions.each_with_index do |subcondition, i| -%>
  <%- name = new_fn_name -%>
  <%- fns << name -%>
  <%= js_for_precondition(subcondition, name) -%>
  <%- end -%>
  return<% -%>
  <%- precondition.restrictions.each do |restriction| -%>
  <%= "#{restriction.type}(" -%>
  <%- end -%>
  <%- if precondition.preconditions && precondition.preconditions.length>0 -%> 
    <%- precondition.preconditions.each_with_index do |subcondition, i| -%>
    <%= "#{subcondition.conjunction}(" if i==0 -%>
      <%= ', ' if i>0 %><%= fns[i] %>(patient)
    <%- end -%>
    )
  <%- precondition.restrictions.each do |restriction| -%>
  <%= ")" -%>
  <%- end -%>;
  <%- else -%>
    matchingStuff;
  <%- end -%>
}
