var <%= name %> = function(patient) {
  <%- nested_precondition_fns = [] -%>
  <%- precondition.preconditions.each_with_index do |subcondition, i| -%>
  <%- name = new_fn_name('prcn') -%>
  <%- nested_precondition_fns << name -%>
  <%= js_for_precondition(subcondition, name) -%>
  <%- end -%>
  <%- nested_comparison_fns = [] -%>
  <%- if precondition.comparison -%>
  <%- name = new_fn_name('comp') -%>
  <%- nested_comparison_fns << name -%>
  <%= js_for_comparison(precondition.comparison, name) %>
  <%- end -%>
  
  var matchingPreconditionEvents = null;
  <%- if precondition.preconditions && precondition.preconditions.length>0 -%> 
    matchingPreconditionEvents = <%= "#{precondition.preconditions[0].conjunction}(" -%>
    <%- precondition.preconditions.each_with_index do |subcondition, i| -%>
      <%- -%><%= ', ' if i>0 %>
      <%- -%> <%= nested_precondition_fns[i] %>(patient)<%- -%>
    <%- end -%>
    <%- -%>);
  <%- end -%>
  
  var matchingComparisonEvents = null;
  <%- if precondition.comparison -%>
  matchingComparisonEvents = <%= nested_comparison_fns[0] %>(patient);
  <%- end -%>
  
  <%- if precondition.negation -%>
  return NOT(OR(matchingPreconditionEvents, matchingComparisonEvents));
  <%- else -%>
  return OR(matchingPreconditionEvents, matchingComparisonEvents);
  <%- end -%>
  
}
